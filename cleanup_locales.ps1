# Script to clean up car and deal related strings from locale files
param(
    [string]$LocalesPath = ".\public\locales"
)

# List of car and deal related patterns to remove
$PatternsToRemove = @(
    # Car-specific patterns
    '^\s*"car_[^"]*":\s*"[^"]*",?\s*$',
    '^\s*"deal_[^"]*":\s*"[^"]*",?\s*$',
    
    # Purchase/sale related patterns (more specific)
    '^\s*"purchase_[^"]*":\s*"[^"]*",?\s*$',
    '^\s*"selling_[^"]*":\s*"[^"]*",?\s*$',
    '^\s*"sale_date":\s*"[^"]*",?\s*$',
    '^\s*"purchase_date":\s*"[^"]*",?\s*$',
    
    # Other car-related patterns
    '^\s*"intermediary_car_[^"]*":\s*"[^"]*",?\s*$',
    '^\s*"error_updating_car_[^"]*":\s*"[^"]*",?\s*$',
    '^\s*"filter_by_car_[^"]*":\s*"[^"]*",?\s*$',
    '^\s*"no_car[^"]*":\s*"[^"]*",?\s*$',
    
    # Sales-specific patterns
    '^\s*"sales":\s*"[^"]*",?\s*$',
    '^\s*"sales_history":\s*"[^"]*",?\s*$'
)

# Additional specific strings to remove
$SpecificStringsToRemove = @(
    'selling_price_from',
    'selling_price_to',
    'selling_price_manual',
    'car_model_details',
    'car_for_sale',
    'buy_price_auto',
    'total_sale_value',
    'car_is_public',
    'car_is_private',
    'car_made_public', 
    'car_made_private',
    'error_updating_car_visibility',
    'enable_sale_price',
    'enter_sale_price',
    'updates_car_sale_price',
    'sale_price_auto',
    'filter_by_car_number',
    'purchase_source',
    'purchase_price',
    'purchase_date',
    'sale_date',
    'error_loading_deals',
    'deal_required',
    # Round 2 additions
    'enter_car_title',
    'enter_car_status',
    'create_car_listing',
    'update_car_information',
    'select_car_type',
    'enter_car_number',
    'transaction_type_purchase',
    'upload_deal_documents_desc',
    'enter_car_details',
    'exchange_deal_for',
    'exchange_deal_description',
    'new_car_details',
    'new_car_from_showroom',
    'customer_old_car_details',
    'old_car_details',
    'old_car_manufacturer',
    'old_car_name',
    'old_car_year',
    'old_car_kilometers',
    'old_car_condition',
    'old_car_market_price',
    'old_car_purchase_price',
    'enter_old_car_manufacturer',
    'enter_old_car_name',
    'enter_old_car_year',
    'enter_old_car_kilometers',
    'enter_old_car_condition',
    'enter_old_car_market_price',
    'enter_old_car_purchase_price',
    'exchange_calculation',
    'customer_car_evaluation',
    'additional_amount_from_customer',
    'customer_car_eval_value',
    'additional_customer_amount',
    'new_car_price',
    'old_car_value',
    'difference_to_pay',
    'old_car_details_required',
    'old_car_purchase_price_required',
    'enter_car_name',
    'upload_contract_image',
    'contract_image_description',
    'contract_image',
    'change_contract_image',
    'select_contract_image',
    'from_provider',
    'from_customer',
    'select_customer',
    'customer_required',
    'create_new_car',
    'car_contract_image',
    'car_source',
    'car_source_description',
    'enter_market_price',
    'enter_buy_price',
    'automate_bill_for_deal',
    'create_bill_without_leaving_page',
    'connected_bills',
    'no_bills_connected',
    'update_deal',
    'add_new_deal',
    'create_new_deal',
    'manage_deals',
    'create_track_deals',
    'deals_closed',
    'no_deals_data',
    'back_to_deals',
    'cancel_deal',
    'confirm_cancel_deal',
    'deal_has_bills_warning',
    'refund_bill_will_be_created',
    'deal_cancel_confirmation',
    'cancellation_reason',
    'enter_cancellation_reason',
    'cancel_reason_required',
    'cancelling',
    'deal_cancelled_successfully',
    'deal_cancelled_with_refund_bill',
    'deal_cancelled_bill_creation_failed',
    'error_cancelling_deal',
    'refund_bill_for_deal',
    'deal_cancelled_refund',
    'cars',
    'available_cars',
    'archived_cars',
    'add_new_car',
    'edit_car',
    'create_car',
    'update_car',
    'enter_year',
    'enter_brand',
    'enter_provider',
    'enter_kilometers',
    'error_adding_car',
    'error_updating_car',
    'error_deleting_car',
    'confirm_delete_car',
    'year',
    'brand',
    'provider',
    'kilometers',
    'year_required',
    'brand_required',
    'kilometers_must_be_positive',
    'price_must_be_positive',
    'new',
    'used',
    'excellent',
    'good',
    'fair',
    'poor',
    'km',
    'back_to_cars',
    'pricing_information',
    'no_images_available',
    'total_images',
    'current_images',
    'add_new_images',
    'first_image_thumbnail',
    'providers',
    'provider_name',
    'provider_address',
    'provider_phone',
    'add_new_provider',
    'edit_provider',
    'provider_preview',
    'provider_information',
    'enter_provider_name',
    'enter_provider_address',
    'enter_provider_phone',
    'provider_added_successfully',
    'provider_updated_successfully',
    'provider_deleted_successfully',
    'error_adding_provider',
    'error_updating_provider',
    'error_deleting_provider',
    'confirm_delete_provider',
    'provider_not_found',
    'create_provider',
    'update_provider',
    'provider_details',
    'provider_name_required',
    'phone_required',
    'address_required',
    'back_to_providers',
    'provider_summary',
    'contact_information',
    'create_provider_description',
    'update_provider_information',
    'provider_id',
    'contact',
    'search_status',
    'no_status_found',
    'select_provider',
    'search_providers',
    'no_providers_found',
    'thumbnail_description',
    'gallery_description',
    'thumbnail_image',
    'gallery_images',
    'change_thumbnail',
    'select_thumbnail',
    'add_gallery_images',
    'recommended_size',
    'images',
    'select_brand',
    'search_brands',
    'no_brands_found',
    'select_status',
    'select_type',
    'search_types',
    'no_types_found',
    'colors',
    'color_variants',
    'add_color',
    'remove_color',
    'color_name',
    'color_value',
    'color_images',
    'upload_color_images',
    'max_color_images',
    'select_color',
    'no_colors_added',
    'add_first_color',
    'color_required',
    'select_country',
    'available_colors',
    'for',
    'max_files',
    'supported_formats',
    'uploaded_files',
    'remove',
    'add_more_attachments',
    'attachment_removed_successfully',
    'error_removing_attachment',
    'attachments_updated_successfully',
    'error_updating_attachments',
    'update_attachments',
    'updating_attachments',
    'select_attachments_to_update',
    'no_attachments_found',
    'no_attachments_added_yet',
    'profit_loss',
    'price_before_tax',
    'total_including_tax',
    'drag_drop_files',
    'browse',
    'replace_file',
    'billing_section',
    'billing_type',
    'tax_invoice',
    'tax_invoice_desc',
    'tax_invoice_with_receipt',
    'tax_invoice_receipt_desc',
    'receipt_only',
    'receipt_only_desc',
    'invoice_details',
    'receipt_details',
    'free_text',
    'enter_additional_notes',
    'tax_18_percent',
    'total_with_tax',
    'payment_type',
    'multiple_payments',
    'payments',
    'add_payment',
    'remove_payment',
    'payment_total_mismatch',
    'payment_exceeds_total',
    'partial_payment_notice',
    'maximum_allowed',
    'paid',
    'remaining',
    'edit_bill_payments',
    'payment',
    'total_payments',
    'bill_total',
    'paid_amount',
    'remaining_amount',
    'fully_paid',
    'manage_payments',
    'save_payments',
    'payments_updated',
    'payments_updated_fully_paid',
    'payment_editing_not_supported',
    'only_receipts_can_edit_payments',
    'expected',
    'edit_payments',
    'received',
    'total_paid',
    'visa',
    'visa_card',
    'cash',
    'bank_transfer',
    'check',
    'installments',
    'card_type',
    'enter_card_type',
    'last_four_digits',
    'bank_name',
    'enter_bank_name',
    'branch',
    'enter_branch',
    'account_number',
    'enter_account_number',
    'transfer_number',
    'enter_transfer_number',
    'transfer_holder_name',
    'enter_transfer_holder_name',
    'branch_number',
    'enter_branch_number',
    'check_number',
    'enter_check_number',
    'check_holder_name',
    'enter_check_holder_name',
    'check_amount',
    'enter_check_amount',
    'check_bank_name',
    'enter_check_bank_name',
    'check_branch_number',
    'enter_check_branch_number',
    'check_account_number',
    'enter_check_account_number',
    'check_branch',
    'enter_check_branch',
    'visa_amount',
    'enter_visa_amount',
    'visa_installments',
    'enter_visa_installments',
    'visa_card_type',
    'enter_visa_card_type',
    'visa_last_four',
    'enter_visa_last_four',
    'cash_amount',
    'enter_cash_amount',
    'approval_number',
    'enter_approval_number',
    'cash_payment_selected',
    'no_additional_details_required',
    'seller_details',
    'buyer_details',
    'select_seller',
    'select_buyer',
    'seller_required',
    'buyer_required',
    'seller_name',
    'seller_phone',
    'seller_country',
    'buyer_phone',
    'buyer_country',
    'seller_information',
    'buyer_information',
    'commission_details',
    'seller_commission',
    'buyer_commission',
    'enter_seller_commission',
    'enter_buyer_commission',
    'seller_commission_required',
    'buyer_commission_required',
    'commission_summary',
    'total_commission',
    'intermediary_deal_description',
    'commission_required',
    'intermediary_deal_for',
    'profit_commission_required',
    'company_commission_details',
    'commission_date',
    'company_commission_amount',
    'commission_description',
    'enter_commission_description',
    'commission_date_required',
    'company_commission_amount_required',
    'company_commission_deal_description',
    'billing_section_same_as_sale_deal',
    'invoice_and_receipt_options_available',
    'seller',
    'buyer',
    'no_seller',
    'no_buyer',
    'filters',
    'clear_filters',
    'all_statuses',
    'year_from',
    'year_to',
    'any_year',
    'price_from',
    'price_to',
    'date_from',
    'date_to',
    'received_from_client',
    'in_inventory',
    'for_sale',
    'download_contract',
    'general',
    'existing_attachments',
    'unknown_type',
    'payment_notes_placeholder',
    'selected_payment_methods',
    'export_pdf',
    'activity_logs_report',
    'generated_on',
    'total_records',
    'export_summary',
    'total_logs',
    'date_range',
    'sale_info',
    'payment_info',
    'invoice_info',
    'report_generated_by',
    'status_active',
    'pdf_exported_successfully',
    'pdf_export_failed',
    'no_data_to_export',
    'pdf_generation_error',
    'please_try_again_later',
    'network_error',
    'check_internet_connection',
    'request_timeout',
    'try_with_fewer_records',
    'no_car_assigned',
    'bank_transfer_order_customer',
    'tax_id',
    # Round 3 additions
    'add_car_to',
    'enter_car_description',
    'add_car_features_description',
    'select_deal_status',
    'select_deal_status_desc',
    # Round 4 additions
    'top_selling',
    'select_car_status',
    'upload_car_images_info',
    'purchase',
    'select_deal_type',
    'enter_deal_title',
    'enter_deal_description',
    'create_deal_description',
    'update_deal_description',
    'select_deal_date_desc',
    'suggested_selling_price',
    'enter_deal_notes',
    'sale_deal_for',
    'sale_deal_description',
    'select_deal_type_desc',
    'upload_car_license_desc',
    # Round 5 additions - remaining strings
    'car',
    'loading_deals',
    'no_deals_available',
    'associated_deal',
    'new_cars',
    'used_cars',
    'luxury_cars',
    'add_cars_to_category_description',
    'error_removing_car',
    'error_loading_cars',
    'remove_car',
    'error_creating_car',
    'total_cars',
    'total_deals',
    'sales_deals_chart',
    'deals_by_type',
    'manage_cars',
    'add_edit_cars',
    'cars_added',
    'deals',
    'deal',
    'select_car',
    'create_deal',
    'Dream Car',
    # Round 6 additions - final cleanup
    'sale_deal_for ',
    'edit_deal',
    'select_deal',
    'delete_deal',
    'error_adding_deal',
    'error_updating_deal',
    'error_deleting_deal',
    'confirm_delete_deal',
    'search_cars',
    'add_car',
    'confirm_delete_selected_deals',
    'confirm_delete_selected_cars'
)

function Clean-LocaleFile {
    param(
        [string]$FilePath
    )
    
    Write-Host "Cleaning $FilePath..."
    
    if (-not (Test-Path $FilePath)) {
        Write-Warning "File not found: $FilePath"
        return
    }
    
    $content = Get-Content $FilePath -Raw
    $lines = Get-Content $FilePath
    $cleanedLines = @()
    
    foreach ($line in $lines) {
        $shouldKeep = $true
        
        # Check against regex patterns
        foreach ($pattern in $PatternsToRemove) {
            if ($line -match $pattern) {
                Write-Host "Removing line (pattern): $line"
                $shouldKeep = $false
                break
            }
        }
        
        # Check against specific strings
        if ($shouldKeep) {
            foreach ($specificString in $SpecificStringsToRemove) {
                if ($line -match "^\s*`"$specificString`":\s*") {
                    Write-Host "Removing line (specific): $line"
                    $shouldKeep = $false
                    break
                }
            }
        }
        
        if ($shouldKeep) {
            $cleanedLines += $line
        }
    }
    
    # Write cleaned content back to file
    $cleanedLines | Set-Content $FilePath -Encoding UTF8
    
    Write-Host "Cleaned $FilePath - Removed $($lines.Count - $cleanedLines.Count) lines"
}

# Process all locale files
$localeFiles = @("en.json", "ae.json", "he.json")

foreach ($file in $localeFiles) {
    $filePath = Join-Path $LocalesPath $file
    Clean-LocaleFile -FilePath $filePath
}

Write-Host "Cleanup completed!"
