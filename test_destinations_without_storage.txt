// Temporary test - comment out the storage upload section in your destinations add page

// Comment out lines ~110-135 (the storage upload section):
/*
if (thumbnailFile) {
    const ext = thumbnailFile.name.split('.').pop()?.toLowerCase() || 'jpg';
    const path = `${id}/thumbnail_${Date.now()}.${ext}`;
    const { error: upErr } = await supabase.storage.from('destinations').upload(path, thumbnailFile, { cacheControl: '3600', upsert: true });
    if (upErr) throw upErr;
    thumbnail_path = `/destinations/${path}`;
}

for (const file of galleryFiles) {
    const ext = file.name.split('.').pop()?.toLowerCase() || 'jpg';
    const path = `${id}/gallery/${Date.now()}_${file.name}`;
    const { error: upErr } = await supabase.storage.from('destinations').upload(path, file, { cacheControl: '3600', upsert: true });
    if (upErr) throw upErr;
    gallery_paths.push(`/destinations/${path}`);
}

if (thumbnail_path || gallery_paths.length > 0) {
    const { error: updErr } = await supabase.from('destinations').update({ thumbnail_path, gallery_paths }).eq('id', id);
    if (updErr) throw updErr;
}
*/

// If the destination gets created successfully without the storage uploads,
// then the issue is definitely in the Storage policies, not authentication.